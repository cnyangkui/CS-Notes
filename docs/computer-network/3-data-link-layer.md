# 数据链路层

数据链路层使用的信道主要有两种：
1. **点对点信道**。一对一的点对点通信方式。
2. **广播信道**。一对多的广播通信方式。

<h2>3.1 使用点对点信道的数据链路层</h2>

<h3>3.1.1 点对点通信步骤</h3>

1. 结点A的数据链路层把网络层交下来的IP数据报添加首部和尾部封装成帧。
2. 结点A把封装好的帧发送给结点B的数据链路层。
3. 若结点B的数据链路层接收到的帧无差错，则从收到的帧中提取IP数据报交给上面的网络层，否则丢弃这个帧。

<div align="center"> <img src="images/3-1.png" width="400"> </div>

<h3>3.1.2三个基本问题</h3>

<h4>1. 封装成帧</h4>

将网络层交下来的IP数据报添加首部和尾部。使用控制字符SOH（16进制编码是01）和EOT（16进制编码是04）表示帧的首部开始和尾部结束。

<div align="center"> <img src="images/3-2.png" width="300"> </div>

<div align="center"> <img src="images/3-3.png" width="350"> </div>

<h4>2. 透明传输</h4>

**透明**表示某一个实际存在的事物看起来却好像不存在一样。

如果帧的数据中的某个字节的二进制恰好和SOH或EOT这种控制字符一样，那么数据链路层会错误地“找到帧的边界”，把剩下的那部分数据丢弃。

<div align="center"> <img src="images/3-4.png" width="350"> </div>

解决方案：发送端的数据链路层在数据中出现控制字符SOH或EOT的前面插入一个转义字符ESC（16进制编码为1B），而在接收端的数据链路层把数据送往网络层之前删除这个插入的转义字符。这种方法叫做**字节填充**或**字符填充**。如果转义字符也出现在数据当中，那么在转义字符前面再插入一个转义字符，接收端收到两个转义字符时删除其中前面的一个。

<div align="center"> <img src="images/3-5.png" width="400"> </div>

<h4>3. 差错检验</h4>

目前数据链路层广泛使用了**循环冗余检验**（CRC）来检查**比特差错**。

发送端把数据划分成帧，假定每帧k个比特。CRC运算在帧后面添加供差错检测的n位冗余码，一共发送(k+n)位。

冗余码的计算方法：假设待传送帧为M。$2^n$乘M作为被除数（相当于在M后面添加n个0），使用双方事先商定的长度为(n+1)位的数P作为除数，用二进制的模2运算（加法不进位，减法按加法规则计算，例如1111+1010=0101）得:

> $2^n • M / P = Q …… R $

上式中Q为上，余数为R。这个余数R就作为冗余码（也叫帧检验序列FCS）拼接在帧M后发送出去。因此发送得帧是$2^n • M+$FCS。当接收端接收到帧进行CRC检验后得到余数为0，就判定这个帧没有差错，否则判定帧有差错。没有确保可靠传输。