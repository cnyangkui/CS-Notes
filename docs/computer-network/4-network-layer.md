# 网络层

* [4.1 网络层提供的两种服务](#4.1)
* [4.2 中间设备](#4.2)
* [4.3 网际协议 IP](#4.3)
  * [4.3.1 分类的 IP 地址](#4.3.1)
    * [1. IP 地址及其表示方法](#4.3.1.1)
    * [2. 常用的三种类别的 IP 地址](#4.3.1.2)
  * [4.3.2 IP 地址与硬件地址](#4.3.2)
  * [4.3.3 地址解析协议 ARP](#4.3.3)

<h2 id="4.1">4.1 网络层提供的两种服务</h2>

1. 虚电路服务，通信时先建立连接，以预留双方通信所需的一切网络资源。
2. 数据报服务，网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务。网络在发送分组时不需先建立连接。每一个分组 (IP 数据包) 独立发送，与前后的分组无关 (不进行编号)。网络层不提供服务质量的承诺。也就是说，所传送的分组可能出错、丢失、重复和失序 (不按序到达终点)，当然也不保证分组交付的时限。

<div align="center"> <img src="images/4-1.png" width="400"></div>
<div align="center"> <img src="images/4-2.png" width="400"></div>

<h2 id="4.2">4.2 中间设备</h2>
将网络互相连接起来要使用一些中间设备。根据中间设备所在层次，有以下四种不同的中间设备：
1. 转发器 -> 物理层
2. 网桥或桥接器 -> 数据链路层
3. 路由器 -> 网络层
4. 网关 -> 网络层以上

<h2 id="4.3">4.3 网际协议 IP</h2>

<h3 id="4.3.1">4.3.1 分类的 IP 地址</h3>

<h4 id="4.3.1.1">1. IP 地址及其表示方法</h4>

IP 地址 ::= { <网络号>, <主机号> }

<div align="center"> <img src="images/4-3.png" width="400"></div>

<h4 id="4.3.1.2">2. 常用的三种类别的 IP 地址</h4>

<div align="center"> <img src="images/4-4.png" width="400"></div>

<div align="center"> <img src="images/4-5.png" width="400"></div>

<h3 id="4.3.2">4.3.2 IP 地址与硬件地址</h3>

物理地址是数据链路层和物理层使用的地址；IP 地址是网络层和以上各层使用的地址，是一种逻辑地址。
<div align="center"> <img src="images/4-6.png" width="400"></div>

下图表示主机 H1 与 主机 H2 通信，HA 为硬件地址。值得注意的是，MAC 帧在不同的网络上传送时，其 MAC 帧首部中的源硬件地址和目的硬件地址要发生变化。
<div align="center"> <img src="images/4-7.png" width="400"></div>

<h3 id="4.3.3">4.3.3 地址解析协议 ARP</h3>

ARP 协议通常划归到网络层，用途是实现由 IP 地址得到硬件地址。

每个主机都有一个 ARP 高速缓存，里面有本局域网上的各主机和路由器的 IP 地址到硬件地址的映射表。

如果主机 A 知道主机 B 的 IP 地址，但是 ARP 高速缓存中没有该 IP 地址到硬件地址的映射，此时主机 A 通过广播的方式发送 ARP 请求分组，主机 B 收到该请求后会发送 ARP 响应分组给主机 A 告知其硬件地址，主机 A 和 主机 B 都会向其高速缓存中写入对方主机 IP 地址到硬件地址的映射。

ARP 对保存在高速缓存中的每一个映射地址项目都设置生存时间，凡超过生存时间的项目会从高速缓存中删除。这样可以解决网络中某终端硬件地址改变（比如因网络适配器损坏而更换）的问题。

<div align="center"> <img src="images/4-8.png" width="400"></div>
